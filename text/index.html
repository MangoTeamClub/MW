<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MW | 文字编辑器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://unpkg.com/quill@1.3.7/dist/quill.snow.css" rel="stylesheet">
    <style>
        :root {
            --mw-gray: #666666;
            --mw-light-gray: #f5f5f5;
            --mw-dark-gray: #333333;
            --mw-border: #d0d0d0;
            --mw-toolbar-bg: #f0f0f0;
            --mw-hover: #e8e8e8;
            --mw-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", "Segoe UI", sans-serif;
        }
        
        body {
            background-color: #f9f9f9;
            color: var(--mw-dark-gray);
            height: 100vh;
            overflow: hidden;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        .title-bar {
            background-color: white;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 50px;
            border-bottom: 1px solid var(--mw-border);
            box-shadow: var(--mw-shadow);
            z-index: 100;
        }
        
        .app-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: var(--mw-gray);
        }
        
        .app-title i {
            font-size: 20px;
        }
        
        .document-title {
            flex: 1;
            margin: 0 20px;
            font-size: 16px;
            color: var(--mw-dark-gray);
            text-align: center;
        }
        
        .window-controls {
            display: flex;
            gap: 10px;
        }
        
        .window-btn {
            background: none;
            border: none;
            font-size: 16px;
            width: 30px;
            height: 30px;
            border-radius: 4px;
            cursor: pointer;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .window-btn:hover {
            background-color: var(--mw-hover);
        }
        
        .toolbar {
            background-color: var(--mw-toolbar-bg);
            padding: 8px 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            border-bottom: 1px solid var(--mw-border);
        }
        
        .toolbar-group {
            display: flex;
            align-items: center;
            padding-right: 10px;
            margin-right: 10px;
            border-right: 1px solid var(--mw-border);
        }
        
        .toolbar-group:last-child {
            border-right: none;
        }
        
        .toolbar-btn {
            background: none;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            color: #444;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: background-color 0.2s;
        }
        
        .toolbar-btn:hover {
            background-color: var(--mw-hover);
        }
        
        .toolbar-btn.active {
            background-color: var(--mw-light-gray);
            color: var(--mw-gray);
            border: 1px solid var(--mw-border);
        }
        
        .toolbar-btn i {
            font-size: 16px;
        }
        
        .separator {
            width: 1px;
            height: 20px;
            background-color: var(--mw-border);
            margin: 0 5px;
        }
        
        /* 文件操作栏 */
        .file-bar {
            background-color: white;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid var(--mw-border);
        }
        
        .file-btn {
            background-color: var(--mw-gray);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }
        
        .file-btn:hover {
            background-color: #555;
        }
        
        .file-btn.secondary {
            background-color: white;
            color: var(--mw-gray);
            border: 1px solid var(--mw-gray);
        }
        
        .file-btn.secondary:hover {
            background-color: var(--mw-light-gray);
        }
        
        /* 编辑区域 */
        .editor-container {
            flex: 1;
            display: flex;
            background-color: white;
            overflow: hidden;
        }
        
        .editor-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        #editor {
            height: 100%;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .ql-container {
            font-family: "Consolas", "Monaco", "Courier New", monospace;
            height: 100%;
            border: none !important;
            font-size: 14px;
        }
        
        .ql-editor {
            padding: 0;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        
        /* 状态栏 */
        .status-bar {
            background-color: white;
            padding: 8px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-top: 1px solid var(--mw-border);
            font-size: 13px;
            color: #666;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* 模态框 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal {
            background-color: white;
            border-radius: 8px;
            width: 400px;
            max-width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        .modal-header {
            padding: 20px;
            background-color: var(--mw-gray);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-header h3 {
            font-weight: 500;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 15px 20px;
            background-color: var(--mw-light-gray);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--mw-border);
            border-radius: 4px;
            font-size: 14px;
        }
        
        /* 消息提示 */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #4caf50;
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            box-shadow: var(--mw-shadow);
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 1001;
        }
        
        .toast.error {
            background-color: #f44336;
        }
        
        .toast.warning {
            background-color: #ff9800;
        }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            .toolbar {
                overflow-x: auto;
            }
            
            .toolbar-group {
                flex-shrink: 0;
            }
            
            .editor-area {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- 顶部标题栏 -->
        <div class="title-bar">
            <div class="app-title">
                <i class="fas fa-file-alt"></i>
                <span>文字编辑器</span>
            </div>
            <div class="document-title" id="documentTitle">未命名.txt</div>
            <div class="window-controls">
                <button class="window-btn" id="minimizeBtn"><i class="fas fa-minus"></i></button>
                <button class="window-btn" id="maximizeBtn"><i class="fas fa-square"></i></button>
                <button class="window-btn" id="closeBtn"><i class="fas fa-times"></i></button>
            </div>
        </div>
        
        <!-- 顶部工具栏 -->
        <div class="toolbar">
            <div class="toolbar-group">
                <button class="toolbar-btn" id="newDocumentBtn">
                    <i class="fas fa-file"></i>
                    <span>新建</span>
                </button>
                <button class="toolbar-btn" id="openDocumentBtn">
                    <i class="fas fa-folder-open"></i>
                    <span>打开</span>
                </button>
                <button class="toolbar-btn" id="saveDocumentBtn">
                    <i class="fas fa-save"></i>
                    <span>保存</span>
                </button>
            </div>
            
            <div class="separator"></div>
            
            <div class="toolbar-group">
                <button class="toolbar-btn" id="undoBtn" title="撤销">
                    <i class="fas fa-undo"></i>
                </button>
                <button class="toolbar-btn" id="redoBtn" title="重做">
                    <i class="fas fa-redo"></i>
                </button>
            </div>
            
            <div class="separator"></div>
            
            <div class="toolbar-group">
                <button class="toolbar-btn" id="boldBtn" title="加粗">
                    <i class="fas fa-bold"></i>
                </button>
                <button class="toolbar-btn" id="italicBtn" title="斜体">
                    <i class="fas fa-italic"></i>
                </button>
                <button class="toolbar-btn" id="underlineBtn" title="下划线">
                    <i class="fas fa-underline"></i>
                </button>
            </div>
            
            <div class="separator"></div>
            
            <div class="toolbar-group">
                <button class="toolbar-btn" id="listBulletBtn" title="项目符号">
                    <i class="fas fa-list-ul"></i>
                </button>
                <button class="toolbar-btn" id="listOrderedBtn" title="编号">
                    <i class="fas fa-list-ol"></i>
                </button>
            </div>
        </div>
        
        <!-- 编辑区域 -->
        <div class="editor-container">
            <div class="editor-area">
                <div id="editor">
                    <!-- 编辑器内容将在这里显示 -->
                </div>
            </div>
        </div>
        
        <!-- 状态栏 -->
        <div class="status-bar">
            <div class="status-item">
                <i class="fas fa-font"></i>
                <span>字数: <span id="wordCount">0</span></span>
            </div>
            <div class="status-item">
                <i class="fas fa-file-alt"></i>
                <span>纯文本编辑器</span>
            </div>
            <div class="status-item">
                <i class="fas fa-expand-alt"></i>
                <span>编码: UTF-8</span>
            </div>
        </div>
    </div>
    
    <!-- 新建文档模态框 -->
    <div class="modal-overlay" id="newDocumentModal">
        <div class="modal">
            <div class="modal-header">
                <h3>新建文本文件</h3>
                <button class="modal-close" id="closeNewModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>文件名称</label>
                    <input type="text" class="form-control" id="newDocumentName" placeholder="请输入文件名称" value="未命名.txt">
                </div>
                <div class="form-group">
                    <label>编码格式</label>
                    <select class="form-control" id="encodingType">
                        <option value="UTF-8" selected>UTF-8</option>
                        <option value="GBK">GBK</option>
                        <option value="ASCII">ASCII</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="file-btn secondary" id="cancelNewDocument">取消</button>
                <button class="file-btn" id="createNewDocument">创建</button>
            </div>
        </div>
    </div>
    
    <!-- 保存文档模态框 -->
    <div class="modal-overlay" id="saveDocumentModal">
        <div class="modal">
            <div class="modal-header">
                <h3>保存文本文件</h3>
                <button class="modal-close" id="closeSaveModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>文件名称</label>
                    <input type="text" class="form-control" id="saveDocumentName" placeholder="请输入文件名称">
                </div>
                <div class="form-group">
                    <label>编码格式</label>
                    <select class="form-control" id="saveEncodingType">
                        <option value="UTF-8" selected>UTF-8</option>
                        <option value="GBK">GBK</option>
                        <option value="ASCII">ASCII</option>
                    </select>
                </div>
                <div class="form-group">
                    <p style="font-size: 14px; color: #666; margin-top: 10px;">
                        <i class="fas fa-info-circle"></i>
                        将保存为纯文本(.txt)格式
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="file-btn secondary" id="cancelSaveDocument">取消</button>
                <button class="file-btn" id="confirmSaveDocument">保存</button>
            </div>
        </div>
    </div>
    
    <!-- 打开文档模态框 -->
    <div class="modal-overlay" id="openDocumentModal">
        <div class="modal">
            <div class="modal-header">
                <h3>打开文本文件</h3>
                <button class="modal-close" id="closeOpenModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>选择文件</label>
                    <input type="file" class="form-control" id="openFileInput" accept=".txt,.text">
                </div>
                <div class="form-group">
                    <p style="font-size: 14px; color: #666; margin-top: 10px;">
                        <i class="fas fa-info-circle"></i>
                        支持打开 .txt, .text 格式的文本文件
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="file-btn secondary" id="cancelOpenDocument">取消</button>
                <button class="file-btn" id="confirmOpenDocument">打开</button>
            </div>
        </div>
    </div>
    
    <!-- 消息提示 -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">操作成功</span>
    </div>

    <!-- 引入必要的库 -->
    <script src="https://unpkg.com/quill@1.3.7/dist/quill.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <script>
        // 初始化Quill编辑器，禁用大多数格式，只保留基本格式
        const quill = new Quill('#editor', {
            theme: 'snow',
            modules: {
                toolbar: false // 禁用Quill自带的工具栏，使用我们自定义的
            }
        });
        
        // 设置初始内容
        quill.setText(`欢迎使用 MW 文字编辑器\n\n这是一个轻量级的纯文本编辑器，支持以下功能：\n\n• 新建文本文件\n• 打开 .txt 和 .text 文件\n• 编辑文本内容\n• 保存为 .txt 格式\n• 下载到本地\n\n开始编辑您的文本吧！`);
        
        // 元素引用
        const documentTitle = document.getElementById('documentTitle');
        const wordCount = document.getElementById('wordCount');
        
        // 模态框元素
        const newDocumentModal = document.getElementById('newDocumentModal');
        const saveDocumentModal = document.getElementById('saveDocumentModal');
        const openDocumentModal = document.getElementById('openDocumentModal');
        
        // 当前文档状态
        let currentDocument = {
            name: '未命名.txt',
            content: '',
            encoding: 'UTF-8',
            lastModified: new Date(),
            wordCount: 0
        };
        
        // 更新文档信息
        function updateDocumentInfo() {
            const text = quill.getText();
            const words = text.trim().split(/\s+/).filter(word => word.length > 0).length;
            currentDocument.wordCount = words;
            wordCount.textContent = words;
            documentTitle.textContent = currentDocument.name;
        }
        
        // 监听编辑器内容变化
        quill.on('text-change', updateDocumentInfo);
        
        // 显示消息提示
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            toast.className = 'toast';
            toast.classList.add(type);
            toast.style.display = 'flex';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }
        
        // 显示模态框
        function showModal(modal) {
            modal.style.display = 'flex';
        }
        
        // 隐藏模态框
        function hideModal(modal) {
            modal.style.display = 'none';
        }
        
        // 初始化文档信息
        updateDocumentInfo();
        
        // 工具栏按钮功能
        document.getElementById('boldBtn').addEventListener('click', function() {
            const range = quill.getSelection();
            if (range) {
                const format = quill.getFormat(range);
                quill.format('bold', !format.bold);
            }
            this.classList.toggle('active');
        });
        
        document.getElementById('italicBtn').addEventListener('click', function() {
            const range = quill.getSelection();
            if (range) {
                const format = quill.getFormat(range);
                quill.format('italic', !format.italic);
            }
            this.classList.toggle('active');
        });
        
        document.getElementById('underlineBtn').addEventListener('click', function() {
            const range = quill.getSelection();
            if (range) {
                const format = quill.getFormat(range);
                quill.format('underline', !format.underline);
            }
            this.classList.toggle('active');
        });
        
        document.getElementById('listBulletBtn').addEventListener('click', function() {
            const range = quill.getSelection();
            if (range) {
                const format = quill.getFormat(range);
                if (format.list === 'bullet') {
                    quill.format('list', false);
                } else {
                    quill.format('list', 'bullet');
                }
            }
        });
        
        document.getElementById('listOrderedBtn').addEventListener('click', function() {
            const range = quill.getSelection();
            if (range) {
                const format = quill.getFormat(range);
                if (format.list === 'ordered') {
                    quill.format('list', false);
                } else {
                    quill.format('list', 'ordered');
                }
            }
        });
        
        document.getElementById('undoBtn').addEventListener('click', function() {
            quill.history.undo();
        });
        
        document.getElementById('redoBtn').addEventListener('click', function() {
            quill.history.redo();
        });
        
        // 新建文档
        document.getElementById('newDocumentBtn').addEventListener('click', function() {
            document.getElementById('newDocumentName').value = '未命名.txt';
            document.getElementById('encodingType').value = 'UTF-8';
            showModal(newDocumentModal);
        });
        
        document.getElementById('createNewDocument').addEventListener('click', function() {
            const docName = document.getElementById('newDocumentName').value || '未命名.txt';
            const encoding = document.getElementById('encodingType').value;
            
            // 确保文件名以.txt结尾
            if (!docName.toLowerCase().endsWith('.txt')) {
                currentDocument.name = docName + '.txt';
            } else {
                currentDocument.name = docName;
            }
            
            currentDocument.encoding = encoding;
            
            // 创建空白文档
            quill.setText('');
            updateDocumentInfo();
            showToast('已创建新文档');
            
            hideModal(newDocumentModal);
        });
        
        document.getElementById('cancelNewDocument').addEventListener('click', function() {
            hideModal(newDocumentModal);
        });
        
        document.getElementById('closeNewModal').addEventListener('click', function() {
            hideModal(newDocumentModal);
        });
        
        // 打开文档
        document.getElementById('openDocumentBtn').addEventListener('click', function() {
            showModal(openDocumentModal);
        });
        
        document.getElementById('openFileInput').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const fileName = file.name;
            const fileExt = fileName.split('.').pop().toLowerCase();
            
            if (fileExt !== 'txt' && fileExt !== 'text') {
                showToast('只支持.txt和.text格式的文件', 'error');
                return;
            }
            
            try {
                const text = await file.text();
                quill.setText(text);
                showToast(`已打开: ${fileName}`);
                
                currentDocument.name = fileName;
                updateDocumentInfo();
                hideModal(openDocumentModal);
                
            } catch (error) {
                console.error('文件打开错误:', error);
                showToast('打开文件时出错: ' + error.message, 'error');
            }
        });
        
        document.getElementById('confirmOpenDocument').addEventListener('click', function() {
            document.getElementById('openFileInput').click();
        });
        
        document.getElementById('cancelOpenDocument').addEventListener('click', function() {
            hideModal(openDocumentModal);
        });
        
        document.getElementById('closeOpenModal').addEventListener('click', function() {
            hideModal(openDocumentModal);
        });
        
        // 保存文档
        document.getElementById('saveDocumentBtn').addEventListener('click', function() {
            document.getElementById('saveDocumentName').value = currentDocument.name;
            document.getElementById('saveEncodingType').value = currentDocument.encoding;
            showModal(saveDocumentModal);
        });
        
        document.getElementById('confirmSaveDocument').addEventListener('click', function() {
            let docName = document.getElementById('saveDocumentName').value || currentDocument.name;
            const encoding = document.getElementById('saveEncodingType').value;
            
            // 确保文件名以.txt结尾
            if (!docName.toLowerCase().endsWith('.txt')) {
                docName = docName + '.txt';
            }
            
            // 更新当前文档信息
            currentDocument.name = docName;
            currentDocument.encoding = encoding;
            updateDocumentInfo();
            
            // 获取编辑器内容
            const content = quill.getText();
            
            // 创建Blob对象
            const blob = new Blob([content], { type: 'text/plain;charset=' + encoding });
            
            // 保存文件
            saveAs(blob, docName);
            
            showToast(`文档已保存为 ${docName}`);
            hideModal(saveDocumentModal);
        });
        
        document.getElementById('cancelSaveDocument').addEventListener('click', function() {
            hideModal(saveDocumentModal);
        });
        
        document.getElementById('closeSaveModal').addEventListener('click', function() {
            hideModal(saveDocumentModal);
        });
        
        // 窗口控制按钮
        document.getElementById('minimizeBtn').addEventListener('click', function() {
            showToast('窗口最小化功能需在桌面应用中实现', 'warning');
        });
        
        document.getElementById('maximizeBtn').addEventListener('click', function() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    showToast('全屏模式已激活');
                });
            } else {
                document.exitFullscreen();
            }
        });
        
        document.getElementById('closeBtn').addEventListener('click', function() {
            if (quill.getText().trim().length > 0) {
                if (confirm('您有未保存的更改。确定要离开吗？')) {
                    showToast('编辑器已关闭', 'warning');
                }
            } else {
                showToast('编辑器已关闭', 'warning');
            }
        });
        
        // 显示欢迎消息
        setTimeout(() => {
            showToast('欢迎使用 MW 文字编辑器！');
        }, 1000);
    </script>
</body>
</html>
