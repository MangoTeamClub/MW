<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MW | 在线文档编辑器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://unpkg.com/quill@1.3.7/dist/quill.snow.css" rel="stylesheet">
    <style>
        :root {
            --wps-blue: #1e6fff;
            --wps-light-blue: #e8f1ff;
            --wps-gray: #f5f5f5;
            --wps-dark-gray: #333;
            --wps-border: #e0e0e0;
            --wps-toolbar-bg: #fafafa;
            --wps-hover: #f0f0f0;
            --wps-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", "Segoe UI", sans-serif;
        }
        
        body {
            background-color: #f0f2f5;
            color: var(--wps-dark-gray);
            height: 100vh;
            overflow: hidden;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        .title-bar {
            background-color: white;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 50px;
            border-bottom: 1px solid var(--wps-border);
            box-shadow: var(--wps-shadow);
            z-index: 100;
        }
        
        .app-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: var(--wps-blue);
        }
        
        .app-title i {
            font-size: 20px;
        }
        
        .document-title {
            flex: 1;
            margin: 0 20px;
            font-size: 16px;
            color: var(--wps-dark-gray);
            text-align: center;
        }
        
        .window-controls {
            display: flex;
            gap: 10px;
        }
        
        .window-btn {
            background: none;
            border: none;
            font-size: 16px;
            width: 30px;
            height: 30px;
            border-radius: 4px;
            cursor: pointer;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .window-btn:hover {
            background-color: var(--wps-hover);
        }
        
        .toolbar {
            background-color: var(--wps-toolbar-bg);
            padding: 8px 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            border-bottom: 1px solid var(--wps-border);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .toolbar-group {
            display: flex;
            align-items: center;
            padding-right: 10px;
            margin-right: 10px;
            border-right: 1px solid var(--wps-border);
        }
        
        .toolbar-group:last-child {
            border-right: none;
        }
        
        .toolbar-btn {
            background: none;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            color: #444;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: background-color 0.2s;
        }
        
        .toolbar-btn:hover {
            background-color: var(--wps-hover);
        }
        
        .toolbar-btn.active {
            background-color: var(--wps-light-blue);
            color: var(--wps-blue);
        }
        
        .toolbar-btn i {
            font-size: 16px;
        }
        
        .separator {
            width: 1px;
            height: 20px;
            background-color: var(--wps-border);
            margin: 0 5px;
        }
        
        /* 文件操作栏 */
        .file-bar {
            background-color: white;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid var(--wps-border);
        }
        
        .file-btn {
            background-color: var(--wps-blue);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }
        
        .file-btn:hover {
            background-color: #0d5ae5;
        }
        
        .file-btn.secondary {
            background-color: white;
            color: var(--wps-blue);
            border: 1px solid var(--wps-blue);
        }
        
        .file-btn.secondary:hover {
            background-color: var(--wps-light-blue);
        }
        
        /* 主要内容区 */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        /* 侧边栏 */
        .sidebar {
            width: 240px;
            background-color: white;
            border-right: 1px solid var(--wps-border);
            padding: 20px;
            overflow-y: auto;
        }
        
        .sidebar-section {
            margin-bottom: 30px;
        }
        
        .sidebar-section h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 12px;
            text-transform: uppercase;
            font-weight: 600;
        }
        
        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 5px;
            transition: background-color 0.2s;
        }
        
        .sidebar-item:hover {
            background-color: var(--wps-hover);
        }
        
        .sidebar-item.active {
            background-color: var(--wps-light-blue);
            color: var(--wps-blue);
        }
        
        .sidebar-item i {
            font-size: 18px;
            width: 20px;
            text-align: center;
        }
        
        /* 编辑区域 */
        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: white;
            overflow: hidden;
        }
        
        .page-container {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            background-color: #f8f9fa;
            display: flex;
            justify-content: center;
        }
        
        .page {
            width: 794px; /* A4宽度 */
            min-height: 1123px; /* A4高度 */
            background-color: white;
            box-shadow: var(--wps-shadow);
            padding: 72px; /* 1英寸边距 */
            position: relative;
        }
        
        #editor {
            height: 100%;
            font-size: 16px;
            line-height: 1.5;
        }
        
        .ql-container {
            font-family: "Times New Roman", serif;
            height: 100%;
            border: none !important;
        }
        
        .ql-editor {
            padding: 0;
            line-height: 1.6;
        }
        
        /* 状态栏 */
        .status-bar {
            background-color: white;
            padding: 8px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-top: 1px solid var(--wps-border);
            font-size: 13px;
            color: #666;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* 模态框 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal {
            background-color: white;
            border-radius: 8px;
            width: 500px;
            max-width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        .modal-header {
            padding: 20px;
            background-color: var(--wps-blue);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-header h3 {
            font-weight: 500;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 15px 20px;
            background-color: var(--wps-gray);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--wps-border);
            border-radius: 4px;
            font-size: 14px;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* 文件类型选项 */
        .file-type-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 10px;
        }
        
        .file-type-option {
            border: 2px solid var(--wps-border);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .file-type-option:hover {
            border-color: var(--wps-blue);
            background-color: var(--wps-light-blue);
        }
        
        .file-type-option.selected {
            border-color: var(--wps-blue);
            background-color: var(--wps-light-blue);
        }
        
        .file-type-icon {
            font-size: 32px;
            margin-bottom: 10px;
            color: var(--wps-blue);
        }
        
        /* 消息提示 */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #4caf50;
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            box-shadow: var(--wps-shadow);
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 1001;
        }
        
        .toast.error {
            background-color: #f44336;
        }
        
        .toast.warning {
            background-color: #ff9800;
        }
        
        /* 响应式调整 */
        @media (max-width: 1200px) {
            .sidebar {
                width: 200px;
            }
            
            .page {
                width: 90%;
                padding: 50px;
            }
        }
        
        @media (max-width: 992px) {
            .sidebar {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .toolbar {
                overflow-x: auto;
            }
            
            .toolbar-group {
                flex-shrink: 0;
            }
            
            .page-container {
                padding: 20px;
            }
            
            .page {
                padding: 30px;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- 顶部标题栏 -->
        <div class="title-bar">
            <div class="app-title">
                <i class="fas fa-file-word"></i>
                <span>在线文档编辑器</span>
            </div>
            <div class="document-title" id="documentTitle">未命名文档</div>
            <div class="window-controls">
                <button class="window-btn" id="minimizeBtn"><i class="fas fa-minus"></i></button>
                <button class="window-btn" id="maximizeBtn"><i class="fas fa-square"></i></button>
                <button class="window-btn" id="closeBtn"><i class="fas fa-times"></i></button>
            </div>
        </div>
        
        <!-- 顶部工具栏 -->
        <div class="toolbar">
            <div class="toolbar-group">
                <button class="toolbar-btn" id="fileMenuBtn">
                    <i class="fas fa-file"></i>
                    <span>文件</span>
                </button>
                <button class="toolbar-btn">
                    <i class="fas fa-home"></i>
                    <span>开始</span>
                </button>
                <button class="toolbar-btn">
                    <i class="fas fa-paste"></i>
                    <span>插入</span>
                </button>
                <button class="toolbar-btn">
                    <i class="fas fa-paint-brush"></i>
                    <span>设计</span>
                </button>
                <button class="toolbar-btn">
                    <i class="fas fa-columns"></i>
                    <span>布局</span>
                </button>
                <button class="toolbar-btn">
                    <i class="fas fa-eye"></i>
                    <span>审阅</span>
                </button>
                <button class="toolbar-btn">
                    <i class="fas fa-chart-bar"></i>
                    <span>视图</span>
                </button>
            </div>
            
            <div class="separator"></div>
            
            <div class="toolbar-group">
                <button class="toolbar-btn" id="undoBtn" title="撤销">
                    <i class="fas fa-undo"></i>
                </button>
                <button class="toolbar-btn" id="redoBtn" title="重做">
                    <i class="fas fa-redo"></i>
                </button>
            </div>
            
            <div class="separator"></div>
            
            <div class="toolbar-group">
                <button class="toolbar-btn" id="fontFamilyBtn">
                    <span>宋体</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <button class="toolbar-btn" id="fontSizeBtn">
                    <span>12</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            
            <div class="separator"></div>
            
            <div class="toolbar-group">
                <button class="toolbar-btn" id="boldBtn" title="加粗">
                    <i class="fas fa-bold"></i>
                </button>
                <button class="toolbar-btn" id="italicBtn" title="斜体">
                    <i class="fas fa-italic"></i>
                </button>
                <button class="toolbar-btn" id="underlineBtn" title="下划线">
                    <i class="fas fa-underline"></i>
                </button>
                <button class="toolbar-btn" id="strikeBtn" title="删除线">
                    <i class="fas fa-strikethrough"></i>
                </button>
            </div>
            
            <div class="separator"></div>
            
            <div class="toolbar-group">
                <button class="toolbar-btn" id="alignLeftBtn" title="左对齐">
                    <i class="fas fa-align-left"></i>
                </button>
                <button class="toolbar-btn" id="alignCenterBtn" title="居中对齐">
                    <i class="fas fa-align-center"></i>
                </button>
                <button class="toolbar-btn" id="alignRightBtn" title="右对齐">
                    <i class="fas fa-align-right"></i>
                </button>
                <button class="toolbar-btn" id="alignJustifyBtn" title="两端对齐">
                    <i class="fas fa-align-justify"></i>
                </button>
            </div>
            
            <div class="separator"></div>
            
            <div class="toolbar-group">
                <button class="toolbar-btn" id="listBulletBtn" title="项目符号">
                    <i class="fas fa-list-ul"></i>
                </button>
                <button class="toolbar-btn" id="listOrderedBtn" title="编号">
                    <i class="fas fa-list-ol"></i>
                </button>
            </div>
        </div>
        
        <!-- 文件操作栏 -->
        <div class="file-bar">
            <button class="file-btn" id="newDocumentBtn">
                <i class="fas fa-file"></i>
                新建
            </button>
            <button class="file-btn secondary" id="openDocumentBtn">
                <i class="fas fa-folder-open"></i>
                打开
            </button>
            <input type="file" id="fileInput" accept=".doc,.docx,.rtf,.txt" style="display: none;">
            <button class="file-btn secondary" id="saveDocumentBtn">
                <i class="fas fa-save"></i>
                保存
            </button>
            <button class="file-btn secondary" id="saveAsBtn">
                <i class="fas fa-download"></i>
                另存为
            </button>
            <div style="flex: 1;"></div>
            <button class="file-btn" id="printBtn">
                <i class="fas fa-print"></i>
                打印
            </button>
        </div>
        
        <!-- 主要内容区 -->
        <div class="main-content">
            <!-- 侧边栏 -->
            <div class="sidebar">
                <div class="sidebar-section">
                    <h3>文档操作</h3>
                    <div class="sidebar-item active" id="sidebarHome">
                        <i class="fas fa-home"></i>
                        <span>文档首页</span>
                    </div>
                    <div class="sidebar-item" id="sidebarRecent">
                        <i class="fas fa-history"></i>
                        <span>最近使用</span>
                    </div>
                    <div class="sidebar-item" id="sidebarTemplates">
                        <i class="fas fa-layer-group"></i>
                        <span>模板中心</span>
                    </div>
                </div>
                
                <div class="sidebar-section">
                    <h3>文档信息</h3>
                    <div class="sidebar-item">
                        <i class="fas fa-info-circle"></i>
                        <span>文档属性</span>
                    </div>
                    <div class="sidebar-item">
                        <i class="fas fa-chart-bar"></i>
                        <span>字数统计</span>
                    </div>
                    <div class="sidebar-item">
                        <i class="fas fa-clock"></i>
                        <span>编辑时间</span>
                    </div>
                </div>
                
                <div class="sidebar-section">
                    <h3>格式设置</h3>
                    <div class="sidebar-item">
                        <i class="fas fa-font"></i>
                        <span>字体设置</span>
                    </div>
                    <div class="sidebar-item">
                        <i class="fas fa-paragraph"></i>
                        <span>段落设置</span>
                    </div>
                    <div class="sidebar-item">
                        <i class="fas fa-palette"></i>
                        <span>主题颜色</span>
                    </div>
                </div>
            </div>
            
            <!-- 编辑区域 -->
            <div class="editor-container">
                <div class="page-container">
                    <div class="page">
                        <div id="editor">
                            <!-- 编辑器内容将在这里显示 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 状态栏 -->
        <div class="status-bar">
            <div class="status-item">
                <i class="fas fa-keyboard"></i>
                <span>中文(简体)</span>
            </div>
            <div class="status-item">
                <i class="fas fa-font"></i>
                <span>字数: <span id="wordCount">0</span></span>
            </div>
            <div class="status-item">
                <i class="fas fa-expand-alt"></i>
                <span>页面: 1/1</span>
            </div>
            <div class="status-item">
                <i class="fas fa-ruler-combined"></i>
                <span>100%</span>
            </div>
        </div>
    </div>
    
    <!-- 新建文档模态框 -->
    <div class="modal-overlay" id="newDocumentModal">
        <div class="modal">
            <div class="modal-header">
                <h3>新建文档</h3>
                <button class="modal-close" id="closeNewModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>文档名称</label>
                    <input type="text" class="form-control" id="newDocumentName" placeholder="请输入文档名称" value="未命名文档">
                </div>
                <div class="form-group">
                    <label>文档类型</label>
                    <div class="file-type-options">
                        <div class="file-type-option selected" data-type="blank">
                            <div class="file-type-icon">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div>空白文档</div>
                        </div>
                        <div class="file-type-option" data-type="template">
                            <div class="file-type-icon">
                                <i class="fas fa-file-contract"></i>
                            </div>
                            <div>使用模板</div>
                        </div>
                        <div class="file-type-option" data-type="import">
                            <div class="file-type-icon">
                                <i class="fas fa-file-import"></i>
                            </div>
                            <div>导入文件</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="file-btn secondary" id="cancelNewDocument">取消</button>
                <button class="file-btn" id="createNewDocument">创建</button>
            </div>
        </div>
    </div>
    
    <!-- 保存文档模态框 -->
    <div class="modal-overlay" id="saveDocumentModal">
        <div class="modal">
            <div class="modal-header">
                <h3>保存文档</h3>
                <button class="modal-close" id="closeSaveModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>文档名称</label>
                    <input type="text" class="form-control" id="saveDocumentName" placeholder="请输入文档名称">
                </div>
                <div class="form-group">
                    <label>保存格式</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="formatDocx" name="format" value="docx" checked>
                            <label for="formatDocx">.docx (Word文档)</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="formatDoc" name="format" value="doc">
                            <label for="formatDoc">.doc (Word 97-2003文档)</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="formatRtf" name="format" value="rtf">
                            <label for="formatRtf">.rtf (富文本格式)</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>保存位置</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="saveLocal" name="saveLocation" value="local" checked>
                            <label for="saveLocal">本地下载</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="saveCloud" name="saveLocation" value="cloud" disabled>
                            <label for="saveCloud">云存储(暂不可用)</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="file-btn secondary" id="cancelSaveDocument">取消</button>
                <button class="file-btn" id="confirmSaveDocument">保存</button>
            </div>
        </div>
    </div>
    
    <!-- 打开文档模态框 -->
    <div class="modal-overlay" id="openDocumentModal">
        <div class="modal">
            <div class="modal-header">
                <h3>打开文档</h3>
                <button class="modal-close" id="closeOpenModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>选择文件</label>
                    <input type="file" class="form-control" id="openFileInput" accept=".doc,.docx,.rtf,.txt">
                </div>
                <div class="form-group">
                    <p style="font-size: 14px; color: #666; margin-top: 10px;">
                        <i class="fas fa-info-circle"></i>
                        支持打开 .doc, .docx, .rtf, .txt 格式的文件
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="file-btn secondary" id="cancelOpenDocument">取消</button>
                <button class="file-btn" id="confirmOpenDocument">打开</button>
            </div>
        </div>
    </div>
    
    <!-- 消息提示 -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">操作成功</span>
    </div>

    <!-- 引入必要的库 -->
    <script src="https://unpkg.com/quill@1.3.7/dist/quill.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docx@7.1.1/build/index.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.5.1/mammoth.browser.min.js"></script>
    
    <script>
        // 初始化Quill编辑器
        const quill = new Quill('#editor', {
            theme: 'snow',
            modules: {
                toolbar: false // 禁用Quill自带的工具栏，使用我们自定义的
            }
        });
        
        // 设置初始内容
        quill.setContents([
            { insert: '欢迎使用Mango在线文档编辑器\n', attributes: { bold: true, size: '20px' } },
            { insert: '\n' },
            { insert: '这是一个在线文档编辑器，支持以下功能：\n\n' },
            { insert: '• 新建文档\n', attributes: { list: 'bullet' } },
            { insert: '• 打开.doc、.docx、.rtf文件\n', attributes: { list: 'bullet' } },
            { insert: '• 编辑文档内容\n', attributes: { list: 'bullet' } },
            { insert: '• 保存为.doc或.docx格式\n', attributes: { list: 'bullet' } },
            { insert: '• 下载到本地\n', attributes: { list: 'bullet' } },
            { insert: '\n' },
            { insert: '开始您的文档编辑吧！\n', attributes: { italic: true } }
        ]);
        
        // 元素引用
        const documentTitle = document.getElementById('documentTitle');
        const wordCount = document.getElementById('wordCount');
        const fileInput = document.getElementById('fileInput');
        
        // 模态框元素
        const newDocumentModal = document.getElementById('newDocumentModal');
        const saveDocumentModal = document.getElementById('saveDocumentModal');
        const openDocumentModal = document.getElementById('openDocumentModal');
        
        // 当前文档状态
        let currentDocument = {
            name: '未命名文档',
            content: '',
            format: 'docx',
            lastModified: new Date(),
            wordCount: 0
        };
        
        // 更新文档信息
        function updateDocumentInfo() {
            const text = quill.getText();
            const words = text.trim().split(/\s+/).filter(word => word.length > 0).length;
            currentDocument.wordCount = words;
            wordCount.textContent = words;
            documentTitle.textContent = currentDocument.name;
        }
        
        // 监听编辑器内容变化
        quill.on('text-change', updateDocumentInfo);
        
        // 显示消息提示
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            toast.className = 'toast';
            toast.classList.add(type);
            toast.style.display = 'flex';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }
        
        // 显示模态框
        function showModal(modal) {
            modal.style.display = 'flex';
        }
        
        // 隐藏模态框
        function hideModal(modal) {
            modal.style.display = 'none';
        }
        
        // 初始化文档信息
        updateDocumentInfo();
        
        // 文件类型选项选择
        document.querySelectorAll('.file-type-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.file-type-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                this.classList.add('selected');
            });
        });
        
        // 工具栏按钮功能
        document.getElementById('boldBtn').addEventListener('click', function() {
            const range = quill.getSelection();
            if (range) {
                const format = quill.getFormat(range);
                quill.format('bold', !format.bold);
            }
            this.classList.toggle('active');
        });
        
        document.getElementById('italicBtn').addEventListener('click', function() {
            const range = quill.getSelection();
            if (range) {
                const format = quill.getFormat(range);
                quill.format('italic', !format.italic);
            }
            this.classList.toggle('active');
        });
        
        document.getElementById('underlineBtn').addEventListener('click', function() {
            const range = quill.getSelection();
            if (range) {
                const format = quill.getFormat(range);
                quill.format('underline', !format.underline);
            }
            this.classList.toggle('active');
        });
        
        document.getElementById('strikeBtn').addEventListener('click', function() {
            const range = quill.getSelection();
            if (range) {
                const format = quill.getFormat(range);
                quill.format('strike', !format.strike);
            }
            this.classList.toggle('active');
        });
        
        document.getElementById('alignLeftBtn').addEventListener('click', function() {
            quill.format('align', 'left');
            updateAlignmentButtons('left');
        });
        
        document.getElementById('alignCenterBtn').addEventListener('click', function() {
            quill.format('align', 'center');
            updateAlignmentButtons('center');
        });
        
        document.getElementById('alignRightBtn').addEventListener('click', function() {
            quill.format('align', 'right');
            updateAlignmentButtons('right');
        });
        
        document.getElementById('alignJustifyBtn').addEventListener('click', function() {
            quill.format('align', 'justify');
            updateAlignmentButtons('justify');
        });
        
        document.getElementById('listBulletBtn').addEventListener('click', function() {
            const range = quill.getSelection();
            if (range) {
                const format = quill.getFormat(range);
                if (format.list === 'bullet') {
                    quill.format('list', false);
                } else {
                    quill.format('list', 'bullet');
                }
            }
        });
        
        document.getElementById('listOrderedBtn').addEventListener('click', function() {
            const range = quill.getSelection();
            if (range) {
                const format = quill.getFormat(range);
                if (format.list === 'ordered') {
                    quill.format('list', false);
                } else {
                    quill.format('list', 'ordered');
                }
            }
        });
        
        document.getElementById('undoBtn').addEventListener('click', function() {
            quill.history.undo();
        });
        
        document.getElementById('redoBtn').addEventListener('click', function() {
            quill.history.redo();
        });
        
        // 更新对齐按钮状态
        function updateAlignmentButtons(alignment) {
            document.querySelectorAll('[id^="align"]').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (alignment === 'left') {
                document.getElementById('alignLeftBtn').classList.add('active');
            } else if (alignment === 'center') {
                document.getElementById('alignCenterBtn').classList.add('active');
            } else if (alignment === 'right') {
                document.getElementById('alignRightBtn').classList.add('active');
            } else if (alignment === 'justify') {
                document.getElementById('alignJustifyBtn').classList.add('active');
            }
        }
        
        // 新建文档
        document.getElementById('newDocumentBtn').addEventListener('click', function() {
            document.getElementById('newDocumentName').value = '未命名文档';
            showModal(newDocumentModal);
        });
        
        document.getElementById('createNewDocument').addEventListener('click', function() {
            const docName = document.getElementById('newDocumentName').value || '未命名文档';
            const selectedType = document.querySelector('.file-type-option.selected').getAttribute('data-type');
            
            if (selectedType === 'blank') {
                // 创建空白文档
                quill.setContents([]);
                currentDocument.name = docName;
                updateDocumentInfo();
                showToast('已创建新文档');
            } else if (selectedType === 'import') {
                // 导入文件
                fileInput.click();
            }
            
            hideModal(newDocumentModal);
        });
        
        document.getElementById('cancelNewDocument').addEventListener('click', function() {
            hideModal(newDocumentModal);
        });
        
        document.getElementById('closeNewModal').addEventListener('click', function() {
            hideModal(newDocumentModal);
        });
        
        // 打开文档
        document.getElementById('openDocumentBtn').addEventListener('click', function() {
            showModal(openDocumentModal);
        });
        
        document.getElementById('openFileInput').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const fileName = file.name;
            const fileExt = fileName.split('.').pop().toLowerCase();
            
            try {
                if (fileExt === 'docx') {
                    // 使用Mammoth处理docx文件
                    const arrayBuffer = await file.arrayBuffer();
                    const result = await mammoth.convertToHtml({arrayBuffer: arrayBuffer});
                    
                    // 清理并插入HTML内容
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = result.value;
                    const cleanContent = tempDiv.textContent || tempDiv.innerText || '';
                    
                    quill.setText(cleanContent);
                    showToast(`已打开: ${fileName}`);
                    
                } else if (fileExt === 'rtf' || fileExt === 'doc' || fileExt === 'txt') {
                    // 对于.rtf、.doc和.txt文件，直接读取文本
                    const text = await file.text();
                    quill.setText(text);
                    showToast(`已打开: ${fileName}`);
                } else {
                    showToast('不支持的文件格式', 'error');
                    return;
                }
                
                currentDocument.name = fileName.replace(/\.[^/.]+$/, "");
                updateDocumentInfo();
                hideModal(openDocumentModal);
                
            } catch (error) {
                console.error('文件打开错误:', error);
                showToast('打开文件时出错: ' + error.message, 'error');
            }
        });
        
        document.getElementById('confirmOpenDocument').addEventListener('click', function() {
            document.getElementById('openFileInput').click();
        });
        
        document.getElementById('cancelOpenDocument').addEventListener('click', function() {
            hideModal(openDocumentModal);
        });
        
        document.getElementById('closeOpenModal').addEventListener('click', function() {
            hideModal(openDocumentModal);
        });
        
        // 保存文档
        document.getElementById('saveDocumentBtn').addEventListener('click', function() {
            document.getElementById('saveDocumentName').value = currentDocument.name;
            showModal(saveDocumentModal);
        });
        
        document.getElementById('saveAsBtn').addEventListener('click', function() {
            document.getElementById('saveDocumentName').value = currentDocument.name;
            showModal(saveDocumentModal);
        });
        
        document.getElementById('confirmSaveDocument').addEventListener('click', async function() {
            const docName = document.getElementById('saveDocumentName').value || currentDocument.name;
            const format = document.querySelector('input[name="format"]:checked').value;
            const saveLocation = document.querySelector('input[name="saveLocation"]:checked').value;
            
            // 更新当前文档名称
            currentDocument.name = docName;
            updateDocumentInfo();
            
            try {
                // 获取编辑器内容
                const content = quill.getText();
                
                if (saveLocation === 'local') {
                    // 创建文件内容
                    let fileContent, fileName, mimeType;
                    
                    if (format === 'docx') {
                        // 创建简单的docx文档
                        const doc = new docx.Document({
                            sections: [{
                                properties: {},
                                children: [
                                    new docx.Paragraph({
                                        children: [
                                            new docx.TextRun({
                                                text: docName,
                                                bold: true,
                                                size: 28,
                                            }),
                                        ],
                                    }),
                                    new docx.Paragraph({
                                        children: [
                                            new docx.TextRun({
                                                text: "\n" + content,
                                                size: 24,
                                            }),
                                        ],
                                    }),
                                ],
                            }],
                        });
                        
                        const blob = await docx.Packer.toBlob(doc);
                        fileName = `${docName}.docx`;
                        saveAs(blob, fileName);
                        
                    } else if (format === 'doc' || format === 'rtf') {
                        // 对于.doc和.rtf格式，我们创建一个简单的文本文件
                        // 注意：这不会生成真正的.doc或.rtf格式，仅用于演示
                        fileContent = content;
                        fileName = `${docName}.${format}`;
                        mimeType = format === 'rtf' ? 'application/rtf' : 'application/msword';
                        
                        const blob = new Blob([fileContent], { type: mimeType });
                        saveAs(blob, fileName);
                    }
                    
                    showToast(`文档已保存为 ${fileName}`);
                }
                
                hideModal(saveDocumentModal);
                
            } catch (error) {
                console.error('保存错误:', error);
                showToast('保存失败: ' + error.message, 'error');
            }
        });
        
        document.getElementById('cancelSaveDocument').addEventListener('click', function() {
            hideModal(saveDocumentModal);
        });
        
        document.getElementById('closeSaveModal').addEventListener('click', function() {
            hideModal(saveDocumentModal);
        });
        
        // 打印功能
        document.getElementById('printBtn').addEventListener('click', function() {
            const printContent = quill.root.innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>打印 - ${currentDocument.name}</title>
                    <style>
                        body { font-family: "Microsoft YaHei", sans-serif; line-height: 1.6; padding: 20px; }
                        @media print {
                            body { padding: 0; }
                        }
                    </style>
                </head>
                <body>
                    <div>${printContent}</div>
                    <script>
                        window.onload = function() {
                            window.print();
                            setTimeout(function() {
                                window.close();
                            }, 500);
                        }
                    <\/script>
                </body>
                </html>
            `);
            printWindow.document.close();
        });
        
        // 侧边栏功能
        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.sidebar-item').forEach(i => {
                    i.classList.remove('active');
                });
                this.classList.add('active');
                
                const id = this.id;
                if (id === 'sidebarRecent') {
                    showToast('最近文档功能正在开发中', 'warning');
                } else if (id === 'sidebarTemplates') {
                    showToast('模板中心功能正在开发中', 'warning');
                }
            });
        });
        
        // 窗口控制按钮
        document.getElementById('minimizeBtn').addEventListener('click', function() {
            showToast('开发中……', 'warning');
        });
        
        document.getElementById('maximizeBtn').addEventListener('click', function() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    showToast('开发中……');
                });
            } else {
                document.exitFullscreen();
            }
        });
        
        document.getElementById('closeBtn').addEventListener('click', function() {
            if (quill.getText().trim().length > 0) {
                if (confirm('您有未保存的更改。确定要离开吗？')) {
                    showToast('编辑器已关闭', 'warning');
                }
            } else {
                showToast('编辑器已关闭', 'warning');
            }
        });
        
        // 初始化对齐按钮状态
        updateAlignmentButtons('left');
        
        // 显示欢迎消息
        setTimeout(() => {
            showToast('欢迎使用MW在线文档编辑器！');
        }, 1000);
    </script>
</body>
</html>
