<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MW | 在线PPT编辑器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://unpkg.com/quill@1.3.7/dist/quill.snow.css" rel="stylesheet">
    <style>
        :root {
            --wps-red: #ff3333;
            --wps-light-red: #ffe8e8;
            --wps-gray: #f5f5f5;
            --wps-dark-gray: #333;
            --wps-border: #e0e0e0;
            --wps-toolbar-bg: #fafafa;
            --wps-hover: #f0f0f0;
            --wps-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --slide-bg: #f8f9fa;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", "Segoe UI", sans-serif;
        }
        
        body {
            background-color: #f0f2f5;
            color: var(--wps-dark-gray);
            height: 100vh;
            overflow: hidden;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        .title-bar {
            background-color: white;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 50px;
            border-bottom: 1px solid var(--wps-border);
            box-shadow: var(--wps-shadow);
            z-index: 100;
        }
        
        .app-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: var(--wps-red);
        }
        
        .app-title i {
            font-size: 20px;
        }
        
        .document-title {
            flex: 1;
            margin: 0 20px;
            font-size: 16px;
            color: var(--wps-dark-gray);
            text-align: center;
        }
        
        .window-controls {
            display: flex;
            gap: 10px;
        }
        
        .window-btn {
            background: none;
            border: none;
            font-size: 16px;
            width: 30px;
            height: 30px;
            border-radius: 4px;
            cursor: pointer;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .window-btn:hover {
            background-color: var(--wps-hover);
        }
        
        .toolbar {
            background-color: var(--wps-toolbar-bg);
            padding: 8px 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            border-bottom: 1px solid var(--wps-border);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .toolbar-group {
            display: flex;
            align-items: center;
            padding-right: 10px;
            margin-right: 10px;
            border-right: 1px solid var(--wps-border);
        }
        
        .toolbar-group:last-child {
            border-right: none;
        }
        
        .toolbar-btn {
            background: none;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            color: #444;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: background-color 0.2s;
        }
        
        .toolbar-btn:hover {
            background-color: var(--wps-hover);
        }
        
        .toolbar-btn.active {
            background-color: var(--wps-light-red);
            color: var(--wps-red);
        }
        
        .toolbar-btn i {
            font-size: 16px;
        }
        
        .separator {
            width: 1px;
            height: 20px;
            background-color: var(--wps-border);
            margin: 0 5px;
        }
        
        /* 文件操作栏 */
        .file-bar {
            background-color: white;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid var(--wps-border);
        }
        
        .file-btn {
            background-color: var(--wps-red);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }
        
        .file-btn:hover {
            background-color: #e60000;
        }
        
        .file-btn.secondary {
            background-color: white;
            color: var(--wps-red);
            border: 1px solid var(--wps-red);
        }
        
        .file-btn.secondary:hover {
            background-color: var(--wps-light-red);
        }
        
        /* 主要内容区 */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        /* 侧边栏 - 幻灯片缩略图 */
        .sidebar {
            width: 200px;
            background-color: white;
            border-right: 1px solid var(--wps-border);
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .slides-container {
            flex: 1;
            overflow-y: auto;
        }
        
        .slide-thumbnail {
            background-color: white;
            border: 2px solid var(--wps-border);
            border-radius: 6px;
            margin-bottom: 15px;
            height: 120px;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .slide-thumbnail:hover {
            border-color: var(--wps-red);
        }
        
        .slide-thumbnail.active {
            border-color: var(--wps-red);
            box-shadow: 0 0 0 2px var(--wps-light-red);
        }
        
        .slide-number {
            background-color: var(--wps-red);
            color: white;
            padding: 2px 8px;
            font-size: 12px;
            border-radius: 4px 4px 0 0;
            text-align: center;
        }
        
        .slide-preview {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            font-size: 12px;
            color: #666;
            text-align: center;
            background-color: var(--slide-bg);
        }
        
        .add-slide-btn {
            background-color: var(--wps-red);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 14px;
            margin-top: 10px;
            transition: background-color 0.2s;
        }
        
        .add-slide-btn:hover {
            background-color: #e60000;
        }
        
        /* 编辑区域 */
        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: white;
            overflow: hidden;
        }
        
        .slide-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: var(--slide-bg);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .slide {
            width: 960px;
            height: 540px;
            background-color: white;
            box-shadow: var(--wps-shadow);
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        .slide-header {
            background-color: var(--wps-red);
            color: white;
            padding: 15px 30px;
            font-size: 24px;
            font-weight: bold;
        }
        
        .slide-content {
            flex: 1;
            padding: 40px 60px;
            overflow-y: auto;
        }
        
        #editor {
            height: 100%;
            font-size: 16px;
            line-height: 1.5;
        }
        
        .ql-container {
            font-family: "Microsoft YaHei", "Segoe UI", sans-serif;
            height: 100%;
            border: none !important;
        }
        
        .ql-editor {
            padding: 0;
            line-height: 1.6;
        }
        
        /* 状态栏 */
        .status-bar {
            background-color: white;
            padding: 8px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-top: 1px solid var(--wps-border);
            font-size: 13px;
            color: #666;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* 模态框 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal {
            background-color: white;
            border-radius: 8px;
            width: 500px;
            max-width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        .modal-header {
            padding: 20px;
            background-color: var(--wps-red);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-header h3 {
            font-weight: 500;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 15px 20px;
            background-color: var(--wps-gray);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--wps-border);
            border-radius: 4px;
            font-size: 14px;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* 文件类型选项 */
        .file-type-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 10px;
        }
        
        .file-type-option {
            border: 2px solid var(--wps-border);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .file-type-option:hover {
            border-color: var(--wps-red);
            background-color: var(--wps-light-red);
        }
        
        .file-type-option.selected {
            border-color: var(--wps-red);
            background-color: var(--wps-light-red);
        }
        
        .file-type-icon {
            font-size: 32px;
            margin-bottom: 10px;
            color: var(--wps-red);
        }
        
        /* 幻灯片布局选项 */
        .slide-layout-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 10px;
        }
        
        .slide-layout-option {
            border: 2px solid var(--wps-border);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .slide-layout-option:hover {
            border-color: var(--wps-red);
            background-color: var(--wps-light-red);
        }
        
        .slide-layout-option.selected {
            border-color: var(--wps-red);
            background-color: var(--wps-light-red);
        }
        
        .slide-layout-icon {
            font-size: 32px;
            margin-bottom: 10px;
            color: var(--wps-red);
        }
        
        /* 消息提示 */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #4caf50;
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            box-shadow: var(--wps-shadow);
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 1001;
        }
        
        .toast.error {
            background-color: #f44336;
        }
        
        .toast.warning {
            background-color: #ff9800;
        }
        
        /* 响应式调整 */
        @media (max-width: 1200px) {
            .sidebar {
                width: 180px;
            }
            
            .slide {
                width: 800px;
                height: 450px;
            }
        }
        
        @media (max-width: 992px) {
            .sidebar {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .toolbar {
                overflow-x: auto;
            }
            
            .toolbar-group {
                flex-shrink: 0;
            }
            
            .slide-container {
                padding: 10px;
            }
            
            .slide {
                width: 100%;
                height: 400px;
            }
            
            .slide-content {
                padding: 20px 30px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- 顶部标题栏 -->
        <div class="title-bar">
            <div class="app-title">
                <i class="fas fa-file-powerpoint"></i>
                <span>在线PPT编辑器</span>
            </div>
            <div class="document-title" id="documentTitle">未命名演示文稿</div>
            <div class="window-controls">
                <button class="window-btn" id="minimizeBtn"><i class="fas fa-minus"></i></button>
                <button class="window-btn" id="maximizeBtn"><i class="fas fa-square"></i></button>
                <button class="window-btn" id="closeBtn"><i class="fas fa-times"></i></button>
            </div>
        </div>
        
        <!-- 顶部工具栏 -->
        <div class="toolbar">
            <div class="toolbar-group">
                <button class="toolbar-btn" id="fileMenuBtn">
                    <i class="fas fa-file"></i>
                    <span>文件</span>
                </button>
                <button class="toolbar-btn active">
                    <i class="fas fa-home"></i>
                    <span>开始</span>
                </button>
                <button class="toolbar-btn">
                    <i class="fas fa-plus"></i>
                    <span>插入</span>
                </button>
                <button class="toolbar-btn">
                    <i class="fas fa-paint-brush"></i>
                    <span>设计</span>
                </button>
                <button class="toolbar-btn">
                    <i class="fas fa-sliders-h"></i>
                    <span>切换</span>
                </button>
                <button class="toolbar-btn">
                    <i class="fas fa-film"></i>
                    <span>动画</span>
                </button>
                <button class="toolbar-btn">
                    <i class="fas fa-eye"></i>
                    <span>幻灯片放映</span>
                </button>
                <button class="toolbar-btn">
                    <i class="fas fa-chart-bar"></i>
                    <span>视图</span>
                </button>
            </div>
            
            <div class="separator"></div>
            
            <div class="toolbar-group">
                <button class="toolbar-btn" id="undoBtn" title="撤销">
                    <i class="fas fa-undo"></i>
                </button>
                <button class="toolbar-btn" id="redoBtn" title="重做">
                    <i class="fas fa-redo"></i>
                </button>
            </div>
            
            <div class="separator"></div>
            
            <div class="toolbar-group">
                <button class="toolbar-btn" id="fontFamilyBtn">
                    <span>微软雅黑</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <button class="toolbar-btn" id="fontSizeBtn">
                    <span>24</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            
            <div class="separator"></div>
            
            <div class="toolbar-group">
                <button class="toolbar-btn" id="boldBtn" title="加粗">
                    <i class="fas fa-bold"></i>
                </button>
                <button class="toolbar-btn" id="italicBtn" title="斜体">
                    <i class="fas fa-italic"></i>
                </button>
                <button class="toolbar-btn" id="underlineBtn" title="下划线">
                    <i class="fas fa-underline"></i>
                </button>
                <button class="toolbar-btn" id="colorBtn" title="字体颜色">
                    <i class="fas fa-font"></i>
                    <i class="fas fa-caret-down" style="font-size: 10px;"></i>
                </button>
            </div>
            
            <div class="separator"></div>
            
            <div class="toolbar-group">
                <button class="toolbar-btn" id="alignLeftBtn" title="左对齐">
                    <i class="fas fa-align-left"></i>
                </button>
                <button class="toolbar-btn" id="alignCenterBtn" title="居中对齐">
                    <i class="fas fa-align-center"></i>
                </button>
                <button class="toolbar-btn" id="alignRightBtn" title="右对齐">
                    <i class="fas fa-align-right"></i>
                </button>
            </div>
            
            <div class="separator"></div>
            
            <div class="toolbar-group">
                <button class="toolbar-btn" id="listBulletBtn" title="项目符号">
                    <i class="fas fa-list-ul"></i>
                </button>
                <button class="toolbar-btn" id="listOrderedBtn" title="编号">
                    <i class="fas fa-list-ol"></i>
                </button>
                <button class="toolbar-btn" id="increaseIndentBtn" title="增加缩进">
                    <i class="fas fa-indent"></i>
                </button>
                <button class="toolbar-btn" id="decreaseIndentBtn" title="减少缩进">
                    <i class="fas fa-outdent"></i>
                </button>
            </div>
        </div>
        
        <!-- 文件操作栏 -->
        <div class="file-bar">
            <button class="file-btn" id="newPresentationBtn">
                <i class="fas fa-file"></i>
                新建
            </button>
            <button class="file-btn secondary" id="openPresentationBtn">
                <i class="fas fa-folder-open"></i>
                打开
            </button>
            <input type="file" id="fileInput" accept=".ppt,.pptx" style="display: none;">
            <button class="file-btn secondary" id="savePresentationBtn">
                <i class="fas fa-save"></i>
                保存
            </button>
            <button class="file-btn secondary" id="saveAsBtn">
                <i class="fas fa-download"></i>
                另存为
            </button>
            <div style="flex: 1;"></div>
            <button class="file-btn" id="presentBtn">
                <i class="fas fa-play"></i>
                放映
            </button>
        </div>
        
        <!-- 主要内容区 -->
        <div class="main-content">
            <!-- 侧边栏 - 幻灯片缩略图 -->
            <div class="sidebar">
                <div class="slides-container" id="slidesContainer">
                    <!-- 幻灯片缩略图将通过JS动态生成 -->
                </div>
                <button class="add-slide-btn" id="addSlideBtn">
                    <i class="fas fa-plus"></i>
                    添加幻灯片
                </button>
            </div>
            
            <!-- 编辑区域 -->
            <div class="editor-container">
                <div class="slide-container">
                    <div class="slide" id="currentSlide">
                        <div class="slide-header" id="slideHeader">幻灯片标题</div>
                        <div class="slide-content">
                            <div id="editor">
                                <!-- 编辑器内容将在这里显示 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 状态栏 -->
        <div class="status-bar">
            <div class="status-item">
                <i class="fas fa-sliders-h"></i>
                <span>幻灯片: <span id="currentSlideNumber">1</span>/<span id="totalSlides">1</span></span>
            </div>
            <div class="status-item">
                <i class="fas fa-font"></i>
                <span>字数: <span id="wordCount">0</span></span>
            </div>
            <div class="status-item">
                <i class="fas fa-expand-alt"></i>
                <span>16:9</span>
            </div>
            <div class="status-item">
                <i class="fas fa-ruler-combined"></i>
                <span>100%</span>
            </div>
        </div>
    </div>
    
    <!-- 新建演示文稿模态框 -->
    <div class="modal-overlay" id="newPresentationModal">
        <div class="modal">
            <div class="modal-header">
                <h3>新建演示文稿</h3>
                <button class="modal-close" id="closeNewModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>演示文稿名称</label>
                    <input type="text" class="form-control" id="newPresentationName" placeholder="请输入演示文稿名称" value="未命名演示文稿">
                </div>
                <div class="form-group">
                    <label>幻灯片布局</label>
                    <div class="slide-layout-options">
                        <div class="slide-layout-option selected" data-layout="title">
                            <div class="slide-layout-icon">
                                <i class="fas fa-heading"></i>
                            </div>
                            <div>标题幻灯片</div>
                        </div>
                        <div class="slide-layout-option" data-layout="title-content">
                            <div class="slide-layout-icon">
                                <i class="fas fa-align-left"></i>
                            </div>
                            <div>标题和内容</div>
                        </div>
                        <div class="slide-layout-option" data-layout="blank">
                            <div class="slide-layout-icon">
                                <i class="fas fa-square"></i>
                            </div>
                            <div>空白</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="file-btn secondary" id="cancelNewPresentation">取消</button>
                <button class="file-btn" id="createNewPresentation">创建</button>
            </div>
        </div>
    </div>
    
    <!-- 保存演示文稿模态框 -->
    <div class="modal-overlay" id="savePresentationModal">
        <div class="modal">
            <div class="modal-header">
                <h3>保存演示文稿</h3>
                <button class="modal-close" id="closeSaveModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>演示文稿名称</label>
                    <input type="text" class="form-control" id="savePresentationName" placeholder="请输入演示文稿名称">
                </div>
                <div class="form-group">
                    <label>保存格式</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="formatPptx" name="format" value="pptx" checked>
                            <label for="formatPptx">.pptx (PowerPoint演示文稿)</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="formatPpt" name="format" value="ppt" disabled>
                            <label for="formatPpt">.ppt (PowerPoint 97-2003演示文稿) - 暂不支持</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="formatPdf" name="format" value="pdf" disabled>
                            <label for="formatPdf">.pdf (PDF文档) - 暂不支持</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>保存位置</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="saveLocal" name="saveLocation" value="local" checked>
                            <label for="saveLocal">本地下载</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="saveCloud" name="saveLocation" value="cloud" disabled>
                            <label for="saveCloud">云存储(暂不可用)</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="file-btn secondary" id="cancelSavePresentation">取消</button>
                <button class="file-btn" id="confirmSavePresentation">保存</button>
            </div>
        </div>
    </div>
    
    <!-- 打开演示文稿模态框 -->
    <div class="modal-overlay" id="openPresentationModal">
        <div class="modal">
            <div class="modal-header">
                <h3>打开演示文稿</h3>
                <button class="modal-close" id="closeOpenModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>选择文件</label>
                    <input type="file" class="form-control" id="openFileInput" accept=".ppt,.pptx">
                </div>
                <div class="form-group">
                    <p style="font-size: 14px; color: #666; margin-top: 10px;">
                        <i class="fas fa-info-circle"></i>
                        支持打开 .ppt, .pptx 格式的文件
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="file-btn secondary" id="cancelOpenPresentation">取消</button>
                <button class="file-btn" id="confirmOpenPresentation">打开</button>
            </div>
        </div>
    </div>
    
    <!-- 消息提示 -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">操作成功</span>
    </div>

    <!-- 引入必要的库 -->
    <script src="https://unpkg.com/quill@1.3.7/dist/quill.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <script>
        // 初始化Quill编辑器
        const quill = new Quill('#editor', {
            theme: 'snow',
            modules: {
                toolbar: false // 禁用Quill自带的工具栏，使用我们自定义的
            }
        });
        
        // 元素引用
        const documentTitle = document.getElementById('documentTitle');
        const wordCount = document.getElementById('wordCount');
        const currentSlideNumber = document.getElementById('currentSlideNumber');
        const totalSlides = document.getElementById('totalSlides');
        const slidesContainer = document.getElementById('slidesContainer');
        const slideHeader = document.getElementById('slideHeader');
        const fileInput = document.getElementById('fileInput');
        
        // 模态框元素
        const newPresentationModal = document.getElementById('newPresentationModal');
        const savePresentationModal = document.getElementById('savePresentationModal');
        const openPresentationModal = document.getElementById('openPresentationModal');
        
        // 幻灯片数据结构
        let slides = [
            {
                id: 1,
                title: "幻灯片标题",
                content: "欢迎使用MW在线PPT编辑器\n\n这是一个在线PPT编辑器，支持以下功能：\n\n• 新建演示文稿\n• 打开.ppt、.pptx文件\n• 编辑幻灯片内容\n• 保存为.pptx格式\n• 下载到本地\n\n开始您的演示文稿创作吧！",
                layout: "title"
            }
        ];
        
        let currentSlideId = 1;
        let currentPresentation = {
            name: '未命名演示文稿',
            slidesCount: 1,
            lastModified: new Date()
        };
        
        // 初始化幻灯片缩略图
        function renderSlideThumbnails() {
            slidesContainer.innerHTML = '';
            
            slides.forEach(slide => {
                const slideThumbnail = document.createElement('div');
                slideThumbnail.className = `slide-thumbnail ${slide.id === currentSlideId ? 'active' : ''}`;
                slideThumbnail.dataset.id = slide.id;
                
                slideThumbnail.innerHTML = `
                    <div class="slide-number">${slide.id}</div>
                    <div class="slide-preview">${slide.title}</div>
                `;
                
                slideThumbnail.addEventListener('click', () => {
                    selectSlide(slide.id);
                });
                
                slidesContainer.appendChild(slideThumbnail);
            });
            
            totalSlides.textContent = slides.length;
        }
        
        // 选择幻灯片
        function selectSlide(slideId) {
            currentSlideId = slideId;
            const slide = slides.find(s => s.id === slideId);
            
            // 更新当前幻灯片显示
            slideHeader.textContent = slide.title;
            
            // 更新编辑器内容
            quill.setText(slide.content || '');
            
            // 更新缩略图状态
            document.querySelectorAll('.slide-thumbnail').forEach(thumb => {
                thumb.classList.remove('active');
                if (parseInt(thumb.dataset.id) === slideId) {
                    thumb.classList.add('active');
                }
            });
            
            // 更新当前幻灯片编号
            currentSlideNumber.textContent = slideId;
            
            // 更新文档信息
            updateDocumentInfo();
        }
        
        // 添加新幻灯片
        function addSlide(layout = "title") {
            const newSlideId = slides.length + 1;
            let title = "新幻灯片";
            let content = "";
            
            if (layout === "title") {
                title = "幻灯片标题";
                content = "幻灯片内容";
            } else if (layout === "title-content") {
                title = "幻灯片标题";
                content = "• 要点1\n• 要点2\n• 要点3";
            } else if (layout === "blank") {
                title = "空白幻灯片";
                content = "";
            }
            
            slides.push({
                id: newSlideId,
                title: title,
                content: content,
                layout: layout
            });
            
            renderSlideThumbnails();
            selectSlide(newSlideId);
            
            return newSlideId;
        }
        
        // 保存当前幻灯片内容
        function saveCurrentSlide() {
            const slideIndex = slides.findIndex(s => s.id === currentSlideId);
            if (slideIndex !== -1) {
                slides[slideIndex].content = quill.getText();
                slides[slideIndex].title = slideHeader.textContent;
            }
        }
        
        // 更新文档信息
        function updateDocumentInfo() {
            const currentSlide = slides.find(s => s.id === currentSlideId);
            const text = currentSlide ? currentSlide.content : '';
            const words = text.trim().split(/\s+/).filter(word => word.length > 0).length;
            wordCount.textContent = words;
            documentTitle.textContent = currentPresentation.name;
        }
        
        // 监听编辑器内容变化
        quill.on('text-change', () => {
            saveCurrentSlide();
            updateDocumentInfo();
        });
        
        // 监听幻灯片标题变化
        slideHeader.addEventListener('blur', () => {
            saveCurrentSlide();
            renderSlideThumbnails();
        });
        
        slideHeader.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                slideHeader.blur();
            }
        });
        
        // 显示消息提示
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            toast.className = 'toast';
            toast.classList.add(type);
            toast.style.display = 'flex';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }
        
        // 显示模态框
        function showModal(modal) {
            modal.style.display = 'flex';
        }
        
        // 隐藏模态框
        function hideModal(modal) {
            modal.style.display = 'none';
        }
        
        // 初始化幻灯片
        renderSlideThumbnails();
        selectSlide(1);
        updateDocumentInfo();
        
        // 幻灯片布局选项选择
        document.querySelectorAll('.slide-layout-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.slide-layout-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                this.classList.add('selected');
            });
        });
        
        // 工具栏按钮功能
        document.getElementById('boldBtn').addEventListener('click', function() {
            const range = quill.getSelection();
            if (range) {
                const format = quill.getFormat(range);
                quill.format('bold', !format.bold);
            }
            this.classList.toggle('active');
        });
        
        document.getElementById('italicBtn').addEventListener('click', function() {
            const range = quill.getSelection();
            if (range) {
                const format = quill.getFormat(range);
                quill.format('italic', !format.italic);
            }
            this.classList.toggle('active');
        });
        
        document.getElementById('underlineBtn').addEventListener('click', function() {
            const range = quill.getSelection();
            if (range) {
                const format = quill.getFormat(range);
                quill.format('underline', !format.underline);
            }
            this.classList.toggle('active');
        });
        
        document.getElementById('alignLeftBtn').addEventListener('click', function() {
            quill.format('align', 'left');
            updateAlignmentButtons('left');
        });
        
        document.getElementById('alignCenterBtn').addEventListener('click', function() {
            quill.format('align', 'center');
            updateAlignmentButtons('center');
        });
        
        document.getElementById('alignRightBtn').addEventListener('click', function() {
            quill.format('align', 'right');
            updateAlignmentButtons('right');
        });
        
        document.getElementById('listBulletBtn').addEventListener('click', function() {
            const range = quill.getSelection();
            if (range) {
                const format = quill.getFormat(range);
                if (format.list === 'bullet') {
                    quill.format('list', false);
                } else {
                    quill.format('list', 'bullet');
                }
            }
        });
        
        document.getElementById('listOrderedBtn').addEventListener('click', function() {
            const range = quill.getSelection();
            if (range) {
                const format = quill.getFormat(range);
                if (format.list === 'ordered') {
                    quill.format('list', false);
                } else {
                    quill.format('list', 'ordered');
                }
            }
        });
        
        document.getElementById('increaseIndentBtn').addEventListener('click', function() {
            const range = quill.getSelection();
            if (range) {
                quill.format('indent', '+1');
            }
        });
        
        document.getElementById('decreaseIndentBtn').addEventListener('click', function() {
            const range = quill.getSelection();
            if (range) {
                quill.format('indent', '-1');
            }
        });
        
        document.getElementById('undoBtn').addEventListener('click', function() {
            quill.history.undo();
        });
        
        document.getElementById('redoBtn').addEventListener('click', function() {
            quill.history.redo();
        });
        
        // 更新对齐按钮状态
        function updateAlignmentButtons(alignment) {
            document.querySelectorAll('[id^="align"]').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (alignment === 'left') {
                document.getElementById('alignLeftBtn').classList.add('active');
            } else if (alignment === 'center') {
                document.getElementById('alignCenterBtn').classList.add('active');
            } else if (alignment === 'right') {
                document.getElementById('alignRightBtn').classList.add('active');
            }
        }
        
        // 添加幻灯片按钮
        document.getElementById('addSlideBtn').addEventListener('click', function() {
            addSlide();
            showToast('已添加新幻灯片');
        });
        
        // 新建演示文稿
        document.getElementById('newPresentationBtn').addEventListener('click', function() {
            document.getElementById('newPresentationName').value = '未命名演示文稿';
            showModal(newPresentationModal);
        });
        
        document.getElementById('createNewPresentation').addEventListener('click', function() {
            const presentationName = document.getElementById('newPresentationName').value || '未命名演示文稿';
            const selectedLayout = document.querySelector('.slide-layout-option.selected').getAttribute('data-layout');
            
            // 重置演示文稿
            slides = [
                {
                    id: 1,
                    title: "幻灯片标题",
                    content: "",
                    layout: selectedLayout
                }
            ];
            
            currentSlideId = 1;
            currentPresentation.name = presentationName;
            currentPresentation.slidesCount = 1;
            currentPresentation.lastModified = new Date();
            
            // 根据布局设置初始内容
            if (selectedLayout === "title") {
                slides[0].title = presentationName;
                slides[0].content = "开始您的演示文稿...";
            } else if (selectedLayout === "title-content") {
                slides[0].title = presentationName;
                slides[0].content = "• 要点1\n• 要点2\n• 要点3";
            } else if (selectedLayout === "blank") {
                slides[0].title = "空白幻灯片";
                slides[0].content = "";
            }
            
            renderSlideThumbnails();
            selectSlide(1);
            updateDocumentInfo();
            
            showToast('已创建新演示文稿');
            hideModal(newPresentationModal);
        });
        
        document.getElementById('cancelNewPresentation').addEventListener('click', function() {
            hideModal(newPresentationModal);
        });
        
        document.getElementById('closeNewModal').addEventListener('click', function() {
            hideModal(newPresentationModal);
        });
        
        // 打开演示文稿
        document.getElementById('openPresentationBtn').addEventListener('click', function() {
            showModal(openPresentationModal);
        });
        
        document.getElementById('openFileInput').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const fileName = file.name;
            const fileExt = fileName.split('.').pop().toLowerCase();
            
            try {
                if (fileExt === 'pptx' || fileExt === 'ppt') {
                    // 模拟打开PPT文件 - 在实际应用中，您可能需要使用专门的库如PPTX.js
                    // 这里我们只是模拟打开操作，创建一个简单的演示文稿
                    
                    // 读取文件内容（模拟）
                    const text = await file.text().catch(() => "模拟PPT内容");
                    
                    // 重置演示文稿
                    slides = [
                        {
                            id: 1,
                            title: fileName.replace(/\.[^/.]+$/, ""),
                            content: "这是从文件加载的演示文稿内容。\n\n• 实际应用中需要PPT解析库\n• 当前为模拟演示\n• 功能开发中...",
                            layout: "title"
                        },
                        {
                            id: 2,
                            title: "第二张幻灯片",
                            content: "• 要点一\n• 要点二\n• 要点三",
                            layout: "title-content"
                        }
                    ];
                    
                    currentSlideId = 1;
                    currentPresentation.name = fileName.replace(/\.[^/.]+$/, "");
                    currentPresentation.slidesCount = slides.length;
                    currentPresentation.lastModified = new Date();
                    
                    renderSlideThumbnails();
                    selectSlide(1);
                    updateDocumentInfo();
                    
                    showToast(`已打开: ${fileName}`);
                } else {
                    showToast('不支持的文件格式', 'error');
                    return;
                }
                
                hideModal(openPresentationModal);
                
            } catch (error) {
                console.error('文件打开错误:', error);
                showToast('打开文件时出错: ' + error.message, 'error');
            }
        });
        
        document.getElementById('confirmOpenPresentation').addEventListener('click', function() {
            document.getElementById('openFileInput').click();
        });
        
        document.getElementById('cancelOpenPresentation').addEventListener('click', function() {
            hideModal(openPresentationModal);
        });
        
        document.getElementById('closeOpenModal').addEventListener('click', function() {
            hideModal(openPresentationModal);
        });
        
        // 保存演示文稿
        document.getElementById('savePresentationBtn').addEventListener('click', function() {
            document.getElementById('savePresentationName').value = currentPresentation.name;
            showModal(savePresentationModal);
        });
        
        document.getElementById('saveAsBtn').addEventListener('click', function() {
            document.getElementById('savePresentationName').value = currentPresentation.name;
            showModal(savePresentationModal);
        });
        
        document.getElementById('confirmSavePresentation').addEventListener('click', async function() {
            const presentationName = document.getElementById('savePresentationName').value || currentPresentation.name;
            const format = document.querySelector('input[name="format"]:checked').value;
            const saveLocation = document.querySelector('input[name="saveLocation"]:checked').value;
            
            // 更新当前演示文稿名称
            currentPresentation.name = presentationName;
            updateDocumentInfo();
            
            try {
                if (saveLocation === 'local') {
                    // 创建PPTX文件内容
                    // 注意：这里只是模拟生成一个简单的文本文件
                    // 实际应用中，您可能需要使用PPTXGenJS等库来生成真实的PPTX文件
                    
                    let fileContent = `MW在线PPT编辑器 - ${presentationName}\n`;
                    fileContent += `保存时间: ${new Date().toLocaleString()}\n`;
                    fileContent += `幻灯片数量: ${slides.length}\n\n`;
                    
                    slides.forEach((slide, index) => {
                        fileContent += `=== 幻灯片 ${slide.id}: ${slide.title} ===\n`;
                        fileContent += slide.content + '\n\n';
                    });
                    
                    const fileName = `${presentationName}.pptx`;
                    const blob = new Blob([fileContent], { 
                        type: 'application/vnd.openxmlformats-officedocument.presentationml.presentation' 
                    });
                    
                    saveAs(blob, fileName);
                    
                    showToast(`演示文稿已保存为 ${fileName}`);
                }
                
                hideModal(savePresentationModal);
                
            } catch (error) {
                console.error('保存错误:', error);
                showToast('保存失败: ' + error.message, 'error');
            }
        });
        
        document.getElementById('cancelSavePresentation').addEventListener('click', function() {
            hideModal(savePresentationModal);
        });
        
        document.getElementById('closeSaveModal').addEventListener('click', function() {
            hideModal(savePresentationModal);
        });
        
        // 放映功能
        document.getElementById('presentBtn').addEventListener('click', function() {
            const slideContent = slides.map(slide => 
                `<div class="slide">
                    <div class="slide-header">${slide.title}</div>
                    <div class="slide-content">${slide.content.replace(/\n/g, '<br>')}</div>
                </div>`
            ).join('');
            
            const presentWindow = window.open('', '_blank');
            presentWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>放映 - ${currentPresentation.name}</title>
                    <style>
                        body { 
                            margin: 0; 
                            padding: 0; 
                            background: #000; 
                            display: flex; 
                            align-items: center; 
                            justify-content: center; 
                            height: 100vh; 
                            overflow: hidden;
                        }
                        .presentation-container {
                            width: 100vw;
                            height: 100vh;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                        }
                        .presentation-slide {
                            width: 90vw;
                            height: 80vh;
                            background: white;
                            border-radius: 10px;
                            box-shadow: 0 0 50px rgba(255, 51, 51, 0.5);
                            display: flex;
                            flex-direction: column;
                            overflow: hidden;
                        }
                        .presentation-slide .slide-header {
                            background: #ff3333;
                            color: white;
                            padding: 20px;
                            font-size: 32px;
                            font-weight: bold;
                        }
                        .presentation-slide .slide-content {
                            flex: 1;
                            padding: 40px;
                            font-size: 24px;
                            line-height: 1.6;
                            overflow-y: auto;
                        }
                        .slide-counter {
                            position: fixed;
                            bottom: 20px;
                            right: 20px;
                            color: white;
                            font-size: 18px;
                            background: rgba(0,0,0,0.5);
                            padding: 10px 20px;
                            border-radius: 20px;
                        }
                        .controls {
                            position: fixed;
                            bottom: 20px;
                            left: 20px;
                            display: flex;
                            gap: 10px;
                        }
                        .control-btn {
                            background: rgba(255, 51, 51, 0.8);
                            color: white;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 5px;
                            cursor: pointer;
                            font-size: 16px;
                        }
                        .control-btn:hover {
                            background: rgba(255, 51, 51, 1);
                        }
                    </style>
                </head>
                <body>
                    <div class="presentation-container" id="presentationContainer">
                        ${slideContent}
                    </div>
                    <div class="controls">
                        <button class="control-btn" id="prevBtn">上一张</button>
                        <button class="control-btn" id="nextBtn">下一张</button>
                        <button class="control-btn" id="exitBtn">退出放映</button>
                    </div>
                    <div class="slide-counter" id="slideCounter">1/${slides.length}</div>
                    <script>
                        let currentSlideIndex = 0;
                        const slides = document.querySelectorAll('.presentation-slide');
                        
                        function showSlide(index) {
                            slides.forEach((slide, i) => {
                                slide.style.display = i === index ? 'flex' : 'none';
                            });
                            document.getElementById('slideCounter').textContent = \`\${index+1}/\${slides.length}\`;
                        }
                        
                        document.getElementById('prevBtn').addEventListener('click', () => {
                            if (currentSlideIndex > 0) {
                                currentSlideIndex--;
                                showSlide(currentSlideIndex);
                            }
                        });
                        
                        document.getElementById('nextBtn').addEventListener('click', () => {
                            if (currentSlideIndex < slides.length - 1) {
                                currentSlideIndex++;
                                showSlide(currentSlideIndex);
                            }
                        });
                        
                        document.getElementById('exitBtn').addEventListener('click', () => {
                            window.close();
                        });
                        
                        document.addEventListener('keydown', (e) => {
                            if (e.key === 'ArrowLeft' || e.key === 'PageUp') {
                                if (currentSlideIndex > 0) {
                                    currentSlideIndex--;
                                    showSlide(currentSlideIndex);
                                }
                            } else if (e.key === 'ArrowRight' || e.key === 'PageDown' || e.key === ' ') {
                                if (currentSlideIndex < slides.length - 1) {
                                    currentSlideIndex++;
                                    showSlide(currentSlideIndex);
                                }
                            } else if (e.key === 'Escape') {
                                window.close();
                            }
                        });
                        
                        // 全屏显示
                        document.documentElement.requestFullscreen().catch(e => console.log(e));
                        
                        showSlide(0);
                    <\/script>
                </body>
                </html>
            `);
            presentWindow.document.close();
        });
        
        // 窗口控制按钮
        document.getElementById('minimizeBtn').addEventListener('click', function() {
            showToast('窗口最小化功能开发中……', 'warning');
        });
        
        document.getElementById('maximizeBtn').addEventListener('click', function() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    showToast('全屏功能开发中……', 'warning');
                });
            } else {
                document.exitFullscreen();
            }
        });
        
        document.getElementById('closeBtn').addEventListener('click', function() {
            if (quill.getText().trim().length > 0) {
                if (confirm('您有未保存的更改。确定要离开吗？')) {
                    showToast('编辑器已关闭', 'warning');
                    // 在实际应用中，这里可能会关闭窗口或跳转
                }
            } else {
                showToast('编辑器已关闭', 'warning');
                // 在实际应用中，这里可能会关闭窗口或跳转
            }
        });
        
        // 初始化对齐按钮状态
        updateAlignmentButtons('left');
        
        // 显示欢迎消息
        setTimeout(() => {
            showToast('欢迎使用MW在线PPT编辑器！');
        }, 1000);
    </script>
</body>
</html>
